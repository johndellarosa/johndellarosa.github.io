<!DOCTYPE html>
<html lang="en-US">
    <head>

        <meta charset="UTF-8">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2C44LTKBE1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2C44LTKBE1');
</script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
            <title>Monte Carlo Method</title>
    
        <!-- Meta tags -->
        
        <meta name="keywords" content="Monte Carlo, numerical method">
        <meta name="author" content="John Della Rosa" >
        <meta name="description" content="Introduction to Monte Carlo method and its application in biology.">
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
        <link rel="apple-touch-icon" sizes="180x180" href="https://johndellarosa.github.io/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://johndellarosa.github.io/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://johndellarosa.github.io/favicon-16x16.png">
        <link rel="manifest" href="https://johndellarosa.github.io/site.webmanifest">
            
        <link rel="stylesheet" href="https://johndellarosa.github.io/style.css"> 
<!-- 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
      

        <script src="../../math.js" type="text/javascript"></script> -->

    </head>
    <body>
        <div class="navbar">
            <b style="margin-right:10px">John Della Rosa</b>| 
            <a href="https://johndellarosa.github.io/index.html">Home</a>|
            <a href="https://johndellarosa.github.io/resume.html">Resume</a>
            <!-- <a href="./index.html#education">Education</a>
            <a href="./index.html#experience">Experience</a>
            <a href="./index.html#skills">Skills</a> -->
            |
            <a href="https://johndellarosa.github.io/biography.html">About</a>|
            <a href="https://johndellarosa.github.io/projects.html">Projects</a>|
            <a href="https://johndellarosa.github.io/Miscellaneous.html">Misc</a>|
            <a href="https://www.linkedin.com/in/johndellarosa/" target="_blank">Linkedin</a>|
            <a href="https://github.com/johndellarosa" target="_blank">Github</a>|
            <a href="https://play.google.com/store/apps/developer?id=JohnDellaRosa" target="_blank">Google Play</a>|
            <a href="https://apps.apple.com/us/developer/john-della-rosa/id1684177615" target="_blank">Apple Store</a>
        
        </div>
        <h2><a href= "Table-of-Contents.html">Biophysical Chemistry Textbook (Work in Progress)</a></h2>

<h3>by John Della Rosa</h3>
        <div id="text-contents" style="width:90%; margin:auto">
            <div id="Monte-Carlo">
                <h1>Monte Carlo Simulations</h1>
                <h2>Introduction</h2>
                The Monte Carlo method is a broad class of computational algorithms that rely on repeated random sampling to obtain numerical results.
                The basic concept is to use simulations with randomness to obtain results that may be unfeasible to obtain analytically or observationally. 


                <h2>Basics of Monte Carlo</h2>
                <h3>Outline</h3>
                <ol>
                    <li>Defining a domain of possible inputs.</li>
                    <li>Generating inputs randomly from a probability distribution over the domain.</li>
                    <li>Performing a deterministic computation on the inputs.</li>
                    <li>Aggregating the results</li>

                </ol>

                <h3>Defining A Domain of Possible Inputs</h3>
                Some questions to ask:
                <ol>
                    <li>What variables will be randomly generated?</li>
                    <li>How often will they be generated per trial?</li>
                </ol>
                <h3>Generating Inputs</h3>
                <h4>Appropriate distribution</h4>
                What distribution will each variable be sampled from? 
                Some common distributions for a given task:
                <ul>
                    <li>Normal distribution: symmetric deviation from a value, with high probability of being around mean</li>
                    <li>Log-Normal distribution: Relative changes are normally distributed</li>
                    <li>Uniform distribution: Comparing versus probability threshold</li>
                    <li>Beta: Randomly generating percentages</li>
                    <li>Exponential distribution: Memory-less waiting for an event</li>
                    <li>Poisson: Number of occurences when events are independent</li>
                    <li>Half-normal distribution: Non-negative values with low kurtosis</li>
                    <li>Bernoulli: binary outcome</li>
                    <li>Binomial: repeated binary outcomes</li>
                    
                </ul>

                <h4>How to Sample</h4>
                For the common distributions, the sampling can be done by many libraries. 
                For more complicated distributions, there are techniques such as inverse transform sampling.

                <h4>Sampling Techniques</h4>
                There are a number of sampling techniques that can be used to reduce variance of the estimator. 

                <ol>
                    <li>Antithetic variates</li>
                    <li>Control variates</li>
                    <li>Importance sampling</li>
                    
                </ol>
                
                <h3>Deterministic Computation</h3>
                <ol>
                    
                </ol>
                <h3>Aggregating Results</h3>
                The Monte Carlo estimator has a standard deviation that scales with the inverse sequare root of n. 




                <h3>Basic Example</h3>
                Monte Carlo is commonly introduced with estimating Pi, and we shall be no exception. 
                If we wished to calculate pi or determine the area of a circle, we can randomly generate points on the set \([-r,r]\times [-r,r]\). 
                The area of the circle would then be the percentage of points in the set \(\{x,y : x^2+y^2\leq r^2\}\) multiplied by the total area of the sample set, \((2r)^2=4r^2\).
                By symmetry, we can restrict the sampling to just one quadrant and the ratio of points within the circle to the total area will be the same.
                Since \(A_{c}=\pi r^2\), we can determine pi by the relationship 

                $$\frac{A_c}{A_s}=\frac{\pi r^2}{4 r^2}=\frac{\pi}{4}$$
                Thus pi is 4 times the fraction of points inside the circle (or quartercircle or semicircle),.

                <img src="Monte-Carlo-Pi-Animation.gif" alt="Monte Carlo Pi Calculation Animation" style="margin:auto; display: block;  width:clamp(300px,30vw, 800px)"/>
                <button type="button" class="collapsible">Python Code</button>
                <div class="content">
                <code style="margin: auto; width: 50%;"><pre>
import numpy as np
import matplotlib.pyplot as plt

def estimate_pi(num_samples):
    inside_circle = 0
    x_inside = []
    y_inside = []
    x_outside = []
    y_outside = []

    for _ in range(num_samples):
        x, y = np.random.uniform(0, 1, 2)  # Randomly sample point in square
        if x**2 + y**2 <= 1:  # Check if point is inside circle
            inside_circle += 1
            x_inside.append(x)
            y_inside.append(y)
        else:
            x_outside.append(x)
            y_outside.append(y)

    return (4.0 * inside_circle) / num_samples, x_inside, y_inside, x_outside, y_outside

num_samples = 10000
pi_estimate, x_inside, y_inside, x_outside, y_outside = estimate_pi(num_samples)

# Plotting
plt.figure(figsize=(8,8))
plt.scatter(x_inside, y_inside, color='blue', s=1)
plt.scatter(x_outside, y_outside, color='red', s=1)
plt.title(f"Estimation of Pi using {num_samples} samples: {pi_estimate}")
plt.xlabel('x')
plt.ylabel('y')
plt.grid(True)
plt.gca().set_aspect('equal', adjustable='box')
plt.show()
                    
                     
</pre>
                </code></div>


                <img src="Monte-Carlo-Pi-Static.png" alt="Monte Carlo Pi Calculation" style="margin:auto; display: block;  width:clamp(300px,30vw, 800px)"/>
                <button type="button" class="collapsible">Python Code</button>
                <div class="content">
                <code style="margin: auto; width: 50%;"><pre>
import numpy as np
import matplotlib.pyplot as plt

def estimate_pi(num_samples):
    inside_circle = 0
    x_inside = []
    y_inside = []
    x_outside = []
    y_outside = []

    for _ in range(num_samples):
        x, y = np.random.uniform(0, 1, 2)  # Randomly sample point in square
        if x**2 + y**2 <= 1:  # Check if point is inside circle
            inside_circle += 1
            x_inside.append(x)
            y_inside.append(y)
        else:
            x_outside.append(x)
            y_outside.append(y)

    return (4.0 * inside_circle) / num_samples, x_inside, y_inside, x_outside, y_outside

num_samples = 10000
pi_estimate, x_inside, y_inside, x_outside, y_outside = estimate_pi(num_samples)

# Plotting
plt.figure(figsize=(8,8))
plt.scatter(x_inside, y_inside, color='blue', s=1)
plt.scatter(x_outside, y_outside, color='red', s=1)
plt.title(f"Estimation of Pi using {num_samples} samples: {pi_estimate}")
plt.xlabel('x')
plt.ylabel('y')
plt.grid(True)
plt.gca().set_aspect('equal', adjustable='box')
plt.show()
                          
</pre>
                </code></div>

                <h2>Selected Applications</h2>
                A classic example is modeling bacteria population.

                <br><br>

                We can start with 1 bacterium. At each time point, it has a 25% chance to split into 2, a 25% chance to die, and 50% chance to do nothing.

                Using probability, you could get a closed form answer, but we can also model this easily. 
                We can run many simulations and take an average to see what the expected number of bacteria are at a given time.
                One advantage is that we can easily change parameters and get results without having to do much work.

                <img src="Monte-Carlo-Bacteria.png" alt="Monte Carlo Bacteria Population" style="margin:auto; display: block;  width:clamp(300px,50vw, 800px)"/>
                <button type="button" class="collapsible">Python Code</button>
                <div class="content">
                <code style="margin: auto; width: 50%;"><pre>
import numpy as np
sns.set_theme(style='whitegrid')
np.random.seed(1)
def simulate_bacteria_growth(steps=100, p_split=0.25, p_die=0.25):
    population = 1  # Start with a single bacteria
    populations_over_time = [population]  # Storing the initial population
    
    
    
    fates = [0,1,-1]
    for _ in range(steps):
        
        fate = np.random.choice(fates,size=population,p=[.5,.25,.25])

        # Update the population
        population += fate.sum()

        # Ensure population doesn't go negative
        population = max(0, population)
        
        populations_over_time.append(population)

    return populations_over_time

def monte_carlo_simulation(runs=1000, steps=100):
    matrix = np.zeros((runs, steps+1))  # +1 to include the initial population

    for run in range(runs):
        matrix[run] = simulate_bacteria_growth(steps)

    return matrix
steps = 100
runs = 1000
matrix = monte_carlo_simulation(runs,steps)
colors = plt.colormaps['tab10'].colors
# For visualization, let's print the first 5 simulations:
# for i in range(5):
#     print(f"Simulation {i+1} populations over time: {matrix[i]}")
for i in range(5):
    
    plt.plot(range(steps+1), matrix[i], label=f"Run {i}", linestyle='-', color=colors[i],alpha=0.7)
plt.title('Bacteria Simulation')
plt.xlabel("Time Point")
plt.ylabel("Population")
plt.legend()
plt.show()              
</pre>
                </code></div>


                </div>

                <div id="Exercises">
                    <h2>Exercises</h2>
                    <ol>
    
                    </ol>
    
    
                </div>
        </div>
        <script>
            var coll = document.getElementsByClassName("collapsible");
            var i;
    
            for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                content.style.display = "none";
                } else {
                content.style.display = "block";
                }
            });
            } 
            </script>
</body>
</html>